@model NhaTroAnCu.Models.TenantManagementViewModel
<div class="form-section">
    <div class="section-title">
        <i class="fas fa-users"></i> Thông Tin Người Thuê
    </div>

    <div id="tenantListContainer">
        @if (Model.Tenants != null && Model.Tenants.Any())
        {
            for (int i = 0; i < Model.Tenants.Count; i++)
            {
                <div class="tenant-card" data-tenant-index="@i">
                    <div class="tenant-card-header">
                        <span class="tenant-number">Người thuê @(i + 1)</span>
                        @if (Model.Tenants.Count > 1)
                        {
                            <button type="button" class="btn-remove-tenant btn btn-sm btn-danger" onclick="removeTenant(@i)">
                                <i class="fas fa-trash"></i> Xóa
                            </button>
                        }
                    </div>

                    @Html.HiddenFor(m => m.Tenants[i].Id)
                    @Html.HiddenFor(m => m.Tenants[i].TenantId)

                    <!-- Phần quét CCCD và upload ảnh -->
                    <div class="scan-section" style="background: #f8f9fa; padding: 15px; border-radius: 5px; margin-bottom: 20px;">
                        <h5 style="color: #2c3e50; margin-bottom: 15px;">
                            <i class="fas fa-id-card"></i> Quét CCCD/CMND & Upload ảnh
                        </h5>

                        <div class="form-group">
                            <label>Upload ảnh CCCD/CMND để tự động điền thông tin</label>
                            <input type="file" class="cccd-file form-control" data-tenant-index="@i" accept="image/*" />
                            <small class="form-text text-muted">
                                Hỗ trợ định dạng: JPG, PNG, GIF. Hệ thống sẽ tự động nhận diện và điền thông tin.
                            </small>
                        </div>

                        <button type="button" class="btn btn-primary btn-scan-cccd" data-tenant-index="@i">
                            <i class="fas fa-qrcode"></i> Quét thông tin CCCD
                        </button>

                        <div class="scan-result hidden" data-tenant-index="@i" style="margin-top: 15px;">
                            <!-- Kết quả quét sẽ hiển thị ở đây -->
                        </div>

                        <div class="form-group" style="margin-top: 15px;">
                            <label>Upload ảnh chân dung (sẽ lưu vào hồ sơ người thuê)</label>
                            <input type="file" name="TenantPhotos[@i]" class="form-control tenant-photo-file" data-tenant-index="@i" accept="image/*" />
                            <small class="form-text text-muted">
                                Ảnh này sẽ được lưu làm ảnh đại diện của người thuê
                            </small>
                        </div>

                        @if (!string.IsNullOrEmpty(Model.Tenants[i].Photo))
                        {
                            <div class="current-photo" style="margin-top: 10px;">
                                <label>Ảnh hiện tại:</label>
                                <img src="@Model.Tenants[i].Photo" alt="@Model.Tenants[i].FullName"
                                     style="max-width: 150px; height: auto; display: block; margin-top: 5px; border: 1px solid #dee2e6; padding: 5px;" />
                            </div>
                        }
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Họ và tên <span class="text-danger">*</span></label>
                            @Html.TextBoxFor(m => m.Tenants[i].FullName, new { @class = "form-control tenant-name", data_tenant_index = i })
                            @Html.ValidationMessageFor(m => m.Tenants[i].FullName, "", new { @class = "text-danger" })
                        </div>

                        <div class="form-group">
                            <label>Số CCCD/CMND <span class="text-danger">*</span></label>
                            @Html.TextBoxFor(m => m.Tenants[i].IdentityCard, new { @class = "form-control tenant-identity", data_tenant_index = i })
                            @Html.ValidationMessageFor(m => m.Tenants[i].IdentityCard, "", new { @class = "text-danger" })
                        </div>

                        <div class="form-group">
                            <label>Số điện thoại</label>
                            @Html.TextBoxFor(m => m.Tenants[i].PhoneNumber, new { @class = "form-control" })
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Ngày sinh</label>
                            @{
                                var birthDateValue = Model.Tenants[i].BirthDate?.ToString("dd/MM/yyyy") ?? "";
                            }
                            @Html.TextBoxFor(m => m.Tenants[i].BirthDate, new { @class = "form-control datetime tenant-birthdate", @Value = birthDateValue, data_tenant_index = i })
                        </div>

                        <div class="form-group">
                            <label>Giới tính</label>
                            @Html.DropDownListFor(m => m.Tenants[i].Gender, new SelectList(new[] {
                                new { Value = "", Text = "-- Chọn --" },
                                new { Value = "NAM", Text = "Nam" },
                                new { Value = "NỮ", Text = "Nữ" },
                                new { Value = "KHÁC", Text = "Khác" }
                            }, "Value", "Text", Model.Tenants[i].Gender), new { @class = "form-control tenant-gender", data_tenant_index = i })
                        </div>

                        <div class="form-group">
                            <label>Dân tộc</label>
                            @Html.TextBoxFor(m => m.Tenants[i].Ethnicity, new { @class = "form-control tenant-ethnicity", data_tenant_index = i })
                        </div>

                        <div class="form-group">
                            <label>Biển số xe</label>
                            @Html.TextBoxFor(m => m.Tenants[i].VehiclePlate, new { @class = "form-control" })
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Địa chỉ thường trú</label>
                        @Html.TextBoxFor(m => m.Tenants[i].PermanentAddress, new { @class = "form-control tenant-address", data_tenant_index = i })
                    </div>
                </div>
            }
        }
    </div>

    <button type="button" class="btn btn-secondary" onclick="addTenant()">
        <i class="fas fa-plus"></i> Thêm người thuê
    </button>
</div>